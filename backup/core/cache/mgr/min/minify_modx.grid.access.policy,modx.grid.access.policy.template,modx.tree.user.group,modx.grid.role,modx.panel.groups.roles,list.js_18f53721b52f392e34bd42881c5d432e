MODx.panel.AccessPolicies=function(config){config=config||{};Ext.applyIf(config,{id:'modx-panel-access-policies',bodyStyle:'',defaults:{collapsible:false,autoHeight:true},items:[{html:'<h2>'+_('policies')+'</h2>',border:false,id:'modx-policies-header',cls:'modx-page-header'},{layout:'form',cls:'main-wrapper',items:[{html:'<p>'+_('policy_management_msg')+'</p>',border:false},{xtype:'modx-grid-access-policy',preventRender:true}]}]});MODx.panel.AccessPolicies.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.AccessPolicies,MODx.FormPanel);Ext.reg('modx-panel-access-policies',MODx.panel.AccessPolicies);MODx.grid.AccessPolicy=function(config){config=config||{};this.sm=new Ext.grid.CheckboxSelectionModel();Ext.applyIf(config,{id:'modx-grid-access-policy',url:MODx.config.connector_url,baseParams:{action:'security/access/policy/getlist'},fields:['id','name','description','class','data','parent','template','template_name','active_permissions','total_permissions','active_of','cls'],paging:true,autosave:true,save_action:'security/access/policy/updatefromgrid',remoteSort:true,sm:this.sm,columns:[this.sm,{header:_('policy_name'),dataIndex:'name',width:200,editor:{xtype:'textfield',allowBlank:false},sortable:true},{header:_('description'),dataIndex:'description',width:375,editor:{xtype:'textfield'}},{header:_('policy_template'),dataIndex:'template_name',width:375},{header:_('active_permissions'),dataIndex:'active_of',width:100,editable:false}],tbar:[{text:_('policy_create'),cls:'primary-button',scope:this,handler:this.createPolicy},{text:_('import'),scope:this,handler:this.importPolicy},{text:_('bulk_actions'),menu:[{text:_('policy_remove_multiple'),handler:this.removeSelected,scope:this}]},'->',{xtype:'textfield',name:'search',id:'modx-policy-search',cls:'x-form-filter',emptyText:_('search_ellipsis'),listeners:{'change':{fn:this.search,scope:this},'render':{fn:function(cmp){new Ext.KeyMap(cmp.getEl(),{key:Ext.EventObject.ENTER,fn:function(){this.fireEvent('change',this.getValue());this.blur();return true;},scope:cmp});},scope:this}}},{xtype:'button',id:'modx-sacpol-filter-clear',cls:'x-form-filter-clear',text:_('filter_clear'),listeners:{'click':{fn:this.clearFilter,scope:this}}}]});MODx.grid.AccessPolicy.superclass.constructor.call(this,config);};Ext.extend(MODx.grid.AccessPolicy,MODx.grid.Grid,{search:function(tf,newValue,oldValue){var nv=newValue||tf;this.getStore().baseParams.query=Ext.isEmpty(nv)||Ext.isObject(nv)?'':nv;this.getBottomToolbar().changePage(1);this.refresh();return true;},clearFilter:function(){this.getStore().baseParams={action:'security/access/policy/getList'};Ext.getCmp('modx-policy-search').reset();this.getBottomToolbar().changePage(1);this.refresh();},editPolicy:function(itm,e){MODx.loadPage('security/access/policy/update','id='+this.menu.record.id);},createPolicy:function(btn,e){var r=this.menu.record;if(!this.windows.apc){this.windows.apc=MODx.load({xtype:'modx-window-access-policy-create',record:r,plugin:this.config.plugin,listeners:{'success':{fn:function(r){this.refresh();},scope:this}}});}
this.windows.apc.reset();this.windows.apc.show(e.target);},exportPolicy:function(btn,e){var id=this.menu.record.id;MODx.Ajax.request({url:this.config.url,params:{action:'security/access/policy/export',id:id},listeners:{'success':{fn:function(r){location.href=this.config.url+'?action=security/access/policy/export&download=1&id='+id+'&HTTP_MODAUTH='+MODx.siteId;},scope:this}}});},importPolicy:function(btn,e){var r={};if(!this.windows.importPolicy){this.windows.importPolicy=MODx.load({xtype:'modx-window-policy-import',record:r,listeners:{'success':{fn:function(o){this.refresh();},scope:this}}});}
this.windows.importPolicy.reset();this.windows.importPolicy.setValues(r);this.windows.importPolicy.show(e.target);},getMenu:function(){var r=this.getSelectionModel().getSelected();var p=r.data.cls;var m=[];if(this.getSelectionModel().getCount()>1){m.push({text:_('policy_remove_multiple'),handler:this.removeSelected});}else{if(p.indexOf('pedit')!=-1){m.push({text:_('policy_update'),handler:this.editPolicy});m.push({text:_('policy_duplicate'),handler:this.confirm.createDelegate(this,["security/access/policy/duplicate","policy_duplicate_confirm"])});}
if(m.length>0){m.push('-');}
m.push({text:_('policy_export'),handler:this.exportPolicy});if(p.indexOf('premove')!=-1){if(m.length>0)m.push('-');m.push({text:_('policy_remove'),handler:this.confirm.createDelegate(this,["security/access/policy/remove","policy_remove_confirm"])});}}
if(m.length>0){this.addContextMenuItem(m);}},removeSelected:function(){var cs=this.getSelectedAsList();if(cs===false)return false;MODx.msg.confirm({title:_('policy_remove_multiple'),text:_('policy_remove_multiple_confirm'),url:this.config.url,params:{action:'security/access/policy/removeMultiple',policies:cs},listeners:{'success':{fn:function(r){this.getSelectionModel().clearSelections(true);this.refresh();},scope:this}}});return true;}});Ext.reg('modx-grid-access-policy',MODx.grid.AccessPolicy);MODx.window.CreateAccessPolicy=function(config){config=config||{};this.ident=config.ident||'cacp'+Ext.id();Ext.applyIf(config,{title:_('policy_create'),url:MODx.config.connector_url,action:'security/access/policy/create',fields:[{fieldLabel:_('name'),description:MODx.expandHelp?'':_('policy_desc_name'),name:'name',id:'modx-'+this.ident+'-name',xtype:'textfield',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-name',html:_('policy_desc_name'),cls:'desc-under'},{fieldLabel:_('policy_template'),description:MODx.expandHelp?'':_('policy_desc_template'),name:'template',hiddenName:'template',id:'modx-'+this.ident+'-template',xtype:'modx-combo-access-policy-template',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-template',html:_('policy_desc_template'),cls:'desc-under'},{fieldLabel:_('description'),description:MODx.expandHelp?'':_('policy_desc_description'),name:'description',id:'modx-'+this.ident+'-description',xtype:'textarea',anchor:'100%',height:50},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-description',html:_('policy_desc_description'),cls:'desc-under'},{name:'class',id:'modx-'+this.ident+'-class',xtype:'hidden'},{name:'id',id:'modx-'+this.ident+'-id',xtype:'hidden'}],keys:[]});MODx.window.CreateAccessPolicy.superclass.constructor.call(this,config);};Ext.extend(MODx.window.CreateAccessPolicy,MODx.Window);Ext.reg('modx-window-access-policy-create',MODx.window.CreateAccessPolicy);MODx.combo.AccessPolicyTemplate=function(config){config=config||{};Ext.applyIf(config,{name:'template',hiddenName:'template',fields:['id','name','description'],forceSelection:true,typeAhead:false,editable:false,allowBlank:false,pageSize:20,url:MODx.config.connector_url,baseParams:{action:'security/access/policy/template/getlist'},tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-weight: bold">{name}</span>','<p style="margin: 0; font-size: 11px; color: gray;">{description}</p></div></tpl>')});MODx.combo.AccessPolicyTemplate.superclass.constructor.call(this,config);};Ext.extend(MODx.combo.AccessPolicyTemplate,MODx.combo.ComboBox);Ext.reg('modx-combo-access-policy-template',MODx.combo.AccessPolicyTemplate);MODx.window.ImportPolicy=function(config){config=config||{};this.ident=config.ident||'imppol-'+Ext.id();Ext.applyIf(config,{title:_('policy_import'),id:'modx-window-policy-import',url:MODx.config.connector_url,action:'security/access/policy/import',fileUpload:true,saveBtnText:_('import'),fields:[{html:_('policy_import_msg'),id:this.ident+'-desc',border:false,cls:'panel-desc',style:'margin-bottom: 10px;'},{xtype:'fileuploadfield',fieldLabel:_('file'),buttonText:_('upload.buttons.upload'),name:'file',id:this.ident+'-file',anchor:'100%'}]});MODx.window.ImportPolicy.superclass.constructor.call(this,config);};Ext.extend(MODx.window.ImportPolicy,MODx.Window);Ext.reg('modx-window-policy-import',MODx.window.ImportPolicy);;MODx.panel.AccessPolicyTemplates=function(config){config=config||{};Ext.applyIf(config,{id:'modx-panel-access-policy-templates',bodyStyle:'',defaults:{collapsible:false,autoHeight:true},items:[{html:'<h2>'+_('policies')+'</h2>',border:false,id:'modx-policy-templates-header',cls:'modx-page-header'},{layout:'form',bodyStyle:'padding: 15px',items:[{html:'<p>'+_('policy_templates.intro_msg')+'</p>',border:false},{xtype:'modx-grid-access-policy-templates',preventRender:true}]}]});MODx.panel.AccessPolicyTemplates.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.AccessPolicyTemplates,MODx.FormPanel);Ext.reg('modx-panel-access-policy-templates',MODx.panel.AccessPolicyTemplates);MODx.grid.AccessPolicyTemplate=function(config){config=config||{};this.sm=new Ext.grid.CheckboxSelectionModel();Ext.applyIf(config,{id:'modx-grid-access-policy-template',url:MODx.config.connector_url,baseParams:{action:'security/access/policy/template/getlist'},fields:['id','name','description','template_group','template_group_name','total_permissions','cls'],paging:true,autosave:true,save_action:'security/access/policy/template/updatefromgrid',remoteSort:true,sm:this.sm,columns:[this.sm,{header:_('name'),dataIndex:'name',width:200,editor:{xtype:'textfield',allowBlank:false},sortable:true},{header:_('description'),dataIndex:'description',width:375,editor:{xtype:'textfield'},sortable:true},{header:_('template_group'),dataIndex:'template_group_name',width:375,sortable:true},{header:_('permissions'),dataIndex:'total_permissions',width:100,editable:false,sortable:false}],tbar:[{text:_('policy_template_create'),cls:'primary-button',scope:this,handler:this.createPolicyTemplate},{text:_('import'),scope:this,handler:this.importPolicyTemplate},{text:_('bulk_actions'),menu:[{text:_('policy_remove_multiple'),handler:this.removeSelected,scope:this}]},'->',{xtype:'textfield',name:'search',id:'modx-policy-template-search',cls:'x-form-filter',emptyText:_('search_ellipsis'),listeners:{'change':{fn:this.search,scope:this},'render':{fn:function(cmp){new Ext.KeyMap(cmp.getEl(),{key:Ext.EventObject.ENTER,fn:function(){this.fireEvent('change',this.getValue());this.blur();return true;},scope:cmp});},scope:this}}},{xtype:'button',id:'modx-sacpoltemp-filter-clear',cls:'x-form-filter-clear',text:_('filter_clear'),listeners:{'click':{fn:this.clearFilter,scope:this}}}]});MODx.grid.AccessPolicyTemplate.superclass.constructor.call(this,config);};Ext.extend(MODx.grid.AccessPolicyTemplate,MODx.grid.Grid,{search:function(tf,newValue,oldValue){var nv=newValue||tf;this.getStore().baseParams.query=Ext.isEmpty(nv)||Ext.isObject(nv)?'':nv;this.getBottomToolbar().changePage(1);this.refresh();return true;},clearFilter:function(){this.getStore().baseParams={action:'security/access/policy/template/getList'};Ext.getCmp('modx-policy-template-search').reset();this.getBottomToolbar().changePage(1);this.refresh();},editPolicyTemplate:function(itm,e){MODx.loadPage('security/access/policy/template/update','id='+this.menu.record.id);},createPolicyTemplate:function(btn,e){var r=this.menu.record;if(!this.windows.aptc){this.windows.aptc=MODx.load({xtype:'modx-window-access-policy-template-create',record:r,plugin:this.config.plugin,listeners:{'success':{fn:function(r){this.refresh();},scope:this}}});}
this.windows.aptc.reset();this.windows.aptc.show(e.target);},exportPolicyTemplate:function(btn,e){var id=this.menu.record.id;MODx.Ajax.request({url:this.config.url,params:{action:'security/access/policy/template/export',id:id},listeners:{'success':{fn:function(r){location.href=this.config.url+'?action=security/access/policy/template/export&download=1&id='+id+'&HTTP_MODAUTH='+MODx.siteId;},scope:this}}});},importPolicyTemplate:function(btn,e){var r={};if(!this.windows.importPolicyTemplate){this.windows.importPolicyTemplate=MODx.load({xtype:'modx-window-policy-template-import',record:r,listeners:{'success':{fn:function(o){this.refresh();},scope:this}}});}
this.windows.importPolicyTemplate.reset();this.windows.importPolicyTemplate.setValues(r);this.windows.importPolicyTemplate.show(e.target);},getMenu:function(){var r=this.getSelectionModel().getSelected();var p=r.data.cls;var m=[];if(this.getSelectionModel().getCount()>1){m.push({text:_('policy_template_remove_multiple'),handler:this.removeSelected});}else{if(p.indexOf('pedit')!=-1){m.push({text:_('policy_template_update'),handler:this.editPolicyTemplate});m.push({text:_('policy_template_duplicate'),handler:this.confirm.createDelegate(this,["security/access/policy/template/duplicate","policy_template_duplicate_confirm"])});}
if(m.length>0){m.push('-');}
m.push({text:_('policy_template_export'),handler:this.exportPolicyTemplate});if(p.indexOf('premove')!=-1){if(m.length>0)m.push('-');m.push({text:_('policy_template_remove'),handler:this.confirm.createDelegate(this,["security/access/policy/template/remove","policy_template_remove_confirm"])});}}
if(m.length>0){this.addContextMenuItem(m);}},removeSelected:function(){var cs=this.getSelectedAsList();if(cs===false)return false;MODx.msg.confirm({title:_('policy_template_remove_multiple'),text:_('policy_template_remove_multiple_confirm'),url:this.config.url,params:{action:'security/access/policy/template/removeMultiple',templates:cs},listeners:{'success':{fn:function(r){this.getSelectionModel().clearSelections(true);this.refresh();},scope:this}}});return true;}});Ext.reg('modx-grid-access-policy-templates',MODx.grid.AccessPolicyTemplate);MODx.window.CreateAccessPolicyTemplate=function(config){config=config||{};this.ident=config.ident||'cacpt'+Ext.id();Ext.applyIf(config,{title:_('policy_template_create'),url:MODx.config.connector_url,action:'security/access/policy/template/create',fields:[{fieldLabel:_('name'),name:'name',id:'modx-'+this.ident+'-name',xtype:'textfield',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-name',html:_('policy_template_desc_name'),cls:'desc-under'},{fieldLabel:_('template_group'),name:'template_group',id:'modx-'+this.ident+'-template-group',xtype:'modx-combo-access-policy-template-group',anchor:'100%',value:1},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-template-group',html:_('policy_template_desc_template_group'),cls:'desc-under'},{fieldLabel:_('description'),name:'description',id:'modx-'+this.ident+'-description',xtype:'textarea',anchor:'100%',height:50},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-description',html:_('policy_template_desc_description'),cls:'desc-under'}],keys:[]});MODx.window.CreateAccessPolicyTemplate.superclass.constructor.call(this,config);};Ext.extend(MODx.window.CreateAccessPolicyTemplate,MODx.Window);Ext.reg('modx-window-access-policy-template-create',MODx.window.CreateAccessPolicyTemplate);MODx.combo.AccessPolicyTemplateGroups=function(config){config=config||{};Ext.applyIf(config,{name:'template_group',hiddenName:'template_group',fields:['id','name','description'],forceSelection:true,typeAhead:false,editable:false,allowBlank:false,url:MODx.config.connector_url,baseParams:{action:'security/access/policy/template/group/getlist'},tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-weight: bold">{name}</span>','<p style="margin: 0; font-size: 11px; color: gray;">{description}</p></div></tpl>')});MODx.combo.AccessPolicyTemplateGroups.superclass.constructor.call(this,config);};Ext.extend(MODx.combo.AccessPolicyTemplateGroups,MODx.combo.ComboBox);Ext.reg('modx-combo-access-policy-template-group',MODx.combo.AccessPolicyTemplateGroups);MODx.window.ImportPolicyTemplate=function(config){config=config||{};this.ident=config.ident||'imppt-'+Ext.id();Ext.applyIf(config,{title:_('policy_template_import'),id:'modx-window-policy-template-import',url:MODx.config.connector_url,action:'security/access/policy/template/import',fileUpload:true,saveBtnText:_('import'),fields:[{html:_('policy_template_import_msg'),id:this.ident+'-desc',border:false,cls:'panel-desc',style:'margin-bottom: 10px;'},{xtype:'fileuploadfield',fieldLabel:_('file'),buttonText:_('upload.buttons.upload'),name:'file',id:this.ident+'-file',anchor:'100%'}]});MODx.window.ImportPolicyTemplate.superclass.constructor.call(this,config);};Ext.extend(MODx.window.ImportPolicyTemplate,MODx.Window);Ext.reg('modx-window-policy-template-import',MODx.window.ImportPolicyTemplate);;MODx.tree.UserGroup=function(config){config=config||{};Ext.applyIf(config,{title:_('user_groups'),id:'modx-tree-usergroup',url:MODx.config.connector_url,action:'security/group/getnodes',sortAction:'security/group/sort',root_id:'n_ug_0',root_name:_('user_groups'),enableDrag:true,enableDrop:true,rootVisible:true,ddAppendOnly:true,useDefaultToolbar:true,tbar:[{text:_('user_group_new'),cls:'primary-button',scope:this,handler:this.createUserGroup.createDelegate(this,[true],true)}]});MODx.tree.UserGroup.superclass.constructor.call(this,config);};Ext.extend(MODx.tree.UserGroup,MODx.tree.Tree,{windows:{},addUser:function(item,e){var n=this.cm.activeNode;var ug=n.id.substr(2).split('_');ug=ug[1];if(ug===undefined){ug=0;}
var r={usergroup:ug};if(!this.windows.adduser){this.windows.adduser=MODx.load({xtype:'modx-window-usergroup-adduser',record:r,listeners:{'success':{fn:this.refresh,scope:this}}});}
this.windows.adduser.setValues(r);this.windows.adduser.show(e.target);},createUserGroup:function(item,e,tbar){tbar=tbar||false;var p;if(tbar===false){var n=this.cm.activeNode;p=n.id.substr(2).split('_');p=p[1];if(p===undefined){p=0;}}else{p=0;}
var r={'parent':p};if(!this.windows.createUsergroup){this.windows.createUsergroup=MODx.load({xtype:'modx-window-usergroup-create',record:r,listeners:{'success':{fn:this.refresh,scope:this}}});}else{this.windows.createUsergroup.setValues(r);}
this.windows.createUsergroup.show(e.target);},updateUserGroup:function(item,e){var n=this.cm.activeNode;var id=n.id.substr(2).split('_');id=id[1];MODx.loadPage('security/usergroup/update','id='+id);},getMenu:function(){var m=[];var n=this.cm.activeNode;var ui=n.getUI();switch(n.attributes.type){case'usergroup':if(ui.hasClass('padduser')){m.push({text:_('user_group_user_add'),handler:this.addUser});m.push('-');}
if(ui.hasClass('pcreate')){m.push({text:_('user_group_create'),handler:this.createUserGroup});}
if(ui.hasClass('pupdate')){m.push({text:_('user_group_update'),handler:this.updateUserGroup});}
if(ui.hasClass('premove')){m.push('-');m.push({text:_('user_group_remove'),handler:this.removeUserGroup});}
break;case'user':m.push({text:_('user_group_user_remove'),handler:this.removeUser})
break;}
return m;},removeUserGroup:function(item,e){var n=this.cm.activeNode;var id=n.id.substr(2).split('_');id=id[1];MODx.msg.confirm({title:_('warning'),text:_('user_group_remove_confirm'),url:this.config.url,params:{action:'security/group/remove',id:id},listeners:{'success':{fn:this.refresh,scope:this}}});},removeUser:function(item,e){var n=this.cm.activeNode;var user_id=n.id.substr(2).split('_');user_id=user_id[1];var group_id=n.parentNode.id.substr(2).split('_');group_id=group_id[1];MODx.msg.confirm({title:_('warning'),text:_('user_group_user_remove_confirm'),url:this.config.url,params:{action:'security/group/removeUser',user_id:user_id,group_id:group_id},listeners:{'success':{fn:this.refresh,scope:this}}});},_handleDrop:function(e){s=false;switch(e.dropNode.attributes.type){case'user':s=!(e.point=='above'||e.point=='below');s=s&&e.target.attributes.type=='usergroup'&&e.point=='append';break;case'usergroup':s=true;break;}
return s;}});Ext.reg('modx-tree-usergroup',MODx.tree.UserGroup);MODx.window.CreateUserGroup=function(config){config=config||{};this.ident=config.ident||'cugrp'+Ext.id();Ext.applyIf(config,{title:_('create_user_group'),id:this.ident,width:700,stateful:false,url:MODx.config.connector_url,action:'security/group/create',fields:[{name:'parent',id:'modx-'+this.ident+'-parent',xtype:'hidden'},{xtype:'textfield',fieldLabel:_('name'),description:MODx.expandHelp?'':_('user_group_desc_name'),name:'name',id:'modx-'+this.ident+'-name',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-name',html:_('user_group_desc_name'),cls:'desc-under'},{xtype:'textarea',fieldLabel:_('description'),description:MODx.expandHelp?'':_('user_group_desc_description'),name:'description',id:'modx-'+this.ident+'-description',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-description',html:_('user_group_desc_description'),cls:'desc-under'},{xtype:'fieldset',collapsible:true,collapsed:false,autoHeight:true,title:_('user_group_aw'),items:[{html:'<p style="margin: 5px 0 0">'+_('user_group_aw_desc')+'</p>',cls:'desc-under'},{layout:'column',border:false,defaults:{layout:'form',labelAlign:'top',anchor:'100%',border:false},items:[{columnWidth:.5,items:[{xtype:'textfield',name:'aw_users',fieldLabel:_('user_group_aw_users'),description:_('user_group_aw_users_desc'),id:this.ident+'-aw-users',anchor:'100%',value:''},{xtype:MODx.expandHelp?'label':'hidden',forId:this.ident+'-aw-users',html:_('user_group_aw_users_desc'),cls:'desc-under'},{fieldLabel:_('user_group_aw_resource_groups'),description:_('user_group_aw_resource_groups_desc'),name:'aw_resource_groups',id:this.ident+'-aw-resource-groups',xtype:'textfield',value:'',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:this.ident+'-aw-resource-groups',html:_('user_group_aw_resource_groups_desc'),cls:'desc-under'},{boxLabel:_('user_group_aw_parallel'),description:_('user_group_aw_parallel_desc'),name:'aw_parallel',id:this.ident+'-aw-parallel',xtype:'checkbox',checked:false,inputValue:1,anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:this.ident+'-aw-parallel',html:_('user_group_aw_parallel_desc'),cls:'desc-under'}]},{columnWidth:.5,items:[{xtype:'textfield',name:'aw_contexts',fieldLabel:_('contexts'),description:MODx.expandHelp?'':_('user_group_aw_contexts_desc'),id:this.ident+'-aw-contexts',anchor:'100%',value:'web'},{xtype:MODx.expandHelp?'label':'hidden',forId:this.ident+'-aw-contexts',html:_('user_group_aw_contexts_desc'),cls:'desc-under'},{xtype:'modx-combo-policy',baseParams:{action:'security/access/policy/getList',group:'Admin',combo:'1'},name:'aw_manager_policy',fieldLabel:_('user_group_aw_manager_policy'),description:MODx.expandHelp?'':_('user_group_aw_manager_policy_desc'),id:this.ident+'-aw-manager-policy',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:this.ident+'-aw-manager-policy',html:_('user_group_aw_manager_policy_desc'),cls:'desc-under'},{fieldLabel:_('user_group_aw_categories'),description:_('user_group_aw_categories_desc'),name:'aw_categories',id:this.ident+'-aw-categories',xtype:'textfield',value:'',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:this.ident+'-aw-categories',html:_('user_group_aw_categories_desc'),cls:'desc-under'}]}]}]}],keys:[]});MODx.window.CreateUserGroup.superclass.constructor.call(this,config);};Ext.extend(MODx.window.CreateUserGroup,MODx.Window);Ext.reg('modx-window-usergroup-create',MODx.window.CreateUserGroup);MODx.window.AddUserToUserGroup=function(config){config=config||{};this.ident=config.ident||'adtug'+Ext.id();Ext.applyIf(config,{title:_('user_group_user_add'),id:this.ident,url:MODx.config.connector_url,action:'security/group/user/create',fields:[{fieldLabel:_('name'),description:MODx.expandHelp?'':_('user_group_user_add_user_desc'),name:'user',hiddenName:'user',xtype:'modx-combo-user',editable:true,typeAhead:true,allowBlank:false,id:'modx-'+this.ident+'-user',anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-role',html:_('user_group_user_add_user_desc'),cls:'desc-under'},{fieldLabel:_('role'),description:MODx.expandHelp?'':_('user_group_user_add_role_desc'),name:'role',hiddenName:'role',xtype:'modx-combo-role',id:'modx-'+this.ident+'-role',allowBlank:false,anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-role',html:_('user_group_user_add_role_desc'),cls:'desc-under'},{name:'usergroup',xtype:'hidden',id:'modx-'+this.ident+'-user-group'}]});MODx.window.AddUserToUserGroup.superclass.constructor.call(this,config);};Ext.extend(MODx.window.AddUserToUserGroup,MODx.Window);Ext.reg('modx-window-usergroup-adduser',MODx.window.AddUserToUserGroup);;MODx.grid.Role=function(config){config=config||{};Ext.applyIf(config,{title:_('roles'),id:'modx-grid-role',url:MODx.config.connector_url,baseParams:{action:'security/role/getlist'},fields:['id','name','description','authority','perm'],paging:true,autosave:true,save_action:'security/role/updatefromgrid',columns:[{header:_('id'),dataIndex:'id',width:50,sortable:true},{header:_('name'),dataIndex:'name',width:150,sortable:true,editor:{xtype:'textfield'}},{header:_('description'),dataIndex:'description',width:350,editor:{xtype:'textfield'}},{header:_('authority'),dataIndex:'authority',width:60,editor:{xtype:'textfield'},sortable:true}],tbar:[{text:_('create_new'),cls:'primary-button',handler:this.createRole,scope:this}]});MODx.grid.Role.superclass.constructor.call(this,config);this.on('beforeedit',this.checkEditable,this);};Ext.extend(MODx.grid.Role,MODx.grid.Grid,{checkEditable:function(o){var p=o.record.data.perm||'';return p.indexOf('edit')!=-1;},getMenu:function(){var r=this.getSelectionModel().getSelected();var p=r.data.perm||'';var m=[];if(p.indexOf('remove')!=-1){m.push({text:_('role_remove'),handler:this.remove.createDelegate(this,['role_remove_confirm','security/role/remove'])});}
return m;},createRole:function(btn,e){this.loadWindow(btn,e,{xtype:'modx-window-role-create',listeners:{'success':{fn:function(){this.refresh();},scope:this}}});}});Ext.reg('modx-grid-role',MODx.grid.Role);MODx.window.CreateRole=function(config){config=config||{};this.ident=config.ident||'crole'+Ext.id();Ext.applyIf(config,{title:_('role_create'),url:MODx.config.connector_url,action:'security/role/create',fields:[{name:'name',fieldLabel:_('name')+'<span class="required">*</span>',id:'modx-'+this.ident+'-name',xtype:'textfield',allowBlank:false,anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-name',html:_('role_desc_name'),cls:'desc-under'},{name:'authority',fieldLabel:_('authority'),xtype:'textfield',id:'modx-'+this.ident+'-authority',allowBlank:false,allowNegative:false,value:0,anchor:'100%'},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-authority',html:_('role_desc_authority'),cls:'desc-under'},{name:'description',fieldLabel:_('description'),id:'modx-'+this.ident+'-description',xtype:'textarea',anchor:'100%',grow:true},{xtype:MODx.expandHelp?'label':'hidden',forId:'modx-'+this.ident+'-description',html:_('role_desc_description'),cls:'desc-under'}],keys:[]});MODx.window.CreateRole.superclass.constructor.call(this,config);};Ext.extend(MODx.window.CreateRole,MODx.Window);Ext.reg('modx-window-role-create',MODx.window.CreateRole);;MODx.panel.GroupsRoles=function(config){config=config||{};Ext.applyIf(config,{id:'modx-panel-groups-roles',cls:'container',defaults:{collapsible:false,autoHeight:true},forceLayout:true,items:[{html:'<h2>'+_('user_group_management')+'</h2>',border:false,cls:'modx-page-header',id:'modx-access-permissions-header'},MODx.getPageStructure(this.getPageTabs(config),{id:'modx-access-permissions-tabs',stateful:true,stateId:'access-tabpanel',stateEvents:['tabchange'],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())};}})]});MODx.panel.GroupsRoles.superclass.constructor.call(this,config);};Ext.extend(MODx.panel.GroupsRoles,MODx.FormPanel,{getPageTabs:function(config){var tbs=[];if(MODx.perm.usergroup_view==1){tbs.push({title:_('user_groups'),autoHeight:true,layout:'form',items:[{html:'<p>'+_('user_group_management_msg')+'</p>',bodyCssClass:'panel-desc',border:false},{title:'',xtype:'modx-tree-usergroup',cls:'main-wrapper'}]});}
if(MODx.perm.view_role==1){tbs.push({title:_('roles'),autoHeight:true,layout:'form',items:[{html:'<p>'+_('roles_msg')+'</p>',bodyCssClass:'panel-desc',border:false},{xtype:'modx-grid-role',cls:'main-wrapper',title:'',preventRender:true}]});}
if(MODx.perm.policy_view==1){tbs.push({title:_('policies'),id:'modx-panel-access-policies',autoHeight:true,layout:'form',items:[{html:'<p>'+_('policy_management_msg')+'</p>',bodyCssClass:'panel-desc',border:false},{xtype:'modx-grid-access-policy',cls:'main-wrapper'}]});}
if(MODx.perm.policy_template_view){tbs.push({title:_('policy_templates'),id:'modx-panel-access-policy-templates',autoHeight:true,layout:'form',items:[{html:'<p>'+_('policy_templates.intro_msg')+'</p>',bodyCssClass:'panel-desc',border:false},{xtype:'modx-grid-access-policy-templates',cls:'main-wrapper'}]});}
return tbs;}});Ext.reg('modx-panel-groups-roles',MODx.panel.GroupsRoles);;MODx.page.GroupsRoles=function(config){config=config||{};Ext.applyIf(config,{components:[{xtype:'modx-panel-groups-roles'}],buttons:[{text:_('help_ex'),id:'modx-abtn-help',handler:MODx.loadHelpPane}]});MODx.page.GroupsRoles.superclass.constructor.call(this,config);};Ext.extend(MODx.page.GroupsRoles,MODx.Component);Ext.reg('modx-page-groups-roles',MODx.page.GroupsRoles);